<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>商品列表</title>
<link rel="stylesheet"
	href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.1/font/bootstrap-icons.css"
	rel="stylesheet">



<style>
/* 为包含"删除全部"按钮的<div>元素添加样式 */
.delete-all-button {
	position: absolute;
	top: 30px;
	right: 75px;
	padding: 10px;
}

/* 为表格的列添加样式以确保按钮不会遮挡内容 */
.table th, .table td {
	position: relative;
}

/* 样式用于购物车为空消息 */
#emptyCartMessage {
	display: none;
	text-align: center;
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
}

/* 使用伪元素添加空购物车图标 */
#emptyCartMessage::before {
	content: "\1F6D2";
	/* Unicode字符编码，这里使用购物车图标 */
	font-size: 100px;
	display: block;
}

#backtoshop {
	position: absolute;
	top: 30px;
	right: 180px;
	padding: 10px;
}
</style>
</head>

<body>
	<div class="container">
		<h1>商品列表</h1>
		<div class="form-check">
			<input type="checkbox" class="form-check-input" id="selectAll"
				checked> <label class="form-check-label" for="selectAll">全選</label>
		</div>
		<table class="table table-bordered">
			<thead>
				<tr>
					<th></th>
					<th>商品名稱</th>
					<th>價格</th>
					<th>描述</th>
					<th>數量</th>
				</tr>
			</thead>
			<tbody id="productTableBody">
			</tbody>
		</table>
		<div class="totalPrice">
			<strong>總價格: $<span id="totalAmount">0</span></strong>
		</div>
	</div>

	<div class="delete-all-button">
		<button class="btn btn-danger" onclick="removeAllProducts()"
			id="deleteAll">删除全部</button>
	</div>

	<div id="emptyCartMessage" style="display: none;">
		<p>購物車為空</p>
	</div>

	<div>
		<div>
			<button class="btn btn-danger" id="backtoshop">
				<a href="/newcart.html">回購物商城</a>
			</button>
		</div>
	</div>






	<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.min.js"></script>

	<script>
//===============================頁面進入需要先載入的================================================//
        document.addEventListener("DOMContentLoaded", function () {
            //LOAD時初始化總價格
            generateProductRows();
            var totalAmountElement = document.getElementById("totalAmount");
            totalAmountElement.textContent = "0";
        });

        var products = [
            {
                name: "iPhone 13",
                price: 1000,
                description: "Apple 的最新款智能手機，搭載 A15 Bionic 處理器和出色的攝像頭性能。",
                maxQuantity: 5
            },

            {
                name: "iPhone 15",
                price: 100,
                description: "Apple 的最新款智能手機，搭載 A15 Bionic 處理器和出色的攝像頭性能。",
                maxQuantity: 5
            },
            // 添加其他商品信息
        ];
        // ==========================動態生成表格=============================================//
        function generateProductRows() {
            var productTableBody = document.getElementById("productTableBody");

            for (var i = 0; i < products.length; i++) {
                var product = products[i];
                var row = document.createElement("tr");
                row.innerHTML = `
                    <td><input type="checkbox" class="productCheckbox"></td>
                    <td>${product.name}</td>
                    <td class="productPrice">$${product.price}</td>
                    <td>${product.description}</td>
                    <td>
                        <select class="quantity-select" onchange="updateTotalPrice()" max="${product.maxQuantity}">
                        </select>
                    </td>
                    <td>
                        <button class="btn btn-danger" onclick="removeProduct(this)">删除</button>
                    </td>
                `;

                var quantitySelect = row.querySelector(".quantity-select");
                for (var j = 1; j <= product.maxQuantity; j++) {
                    var option = document.createElement("option");
                    option.value = j;
                    option.textContent = j;
                    quantitySelect.appendChild(option);
                }

                productTableBody.appendChild(row);
            }
        }


        //勾選全部
        function updateSelectAll() {
            var productCheckboxes = document.querySelectorAll(".productCheckbox");
            var selectAllCheckbox = document.getElementById("selectAll");
            selectAllCheckbox.checked = Array.from(productCheckboxes).every(function (checkbox) {
                return checkbox.checked;
            });
        }

        //全選的時候更新總價格
        var selectAllCheckbox = document.getElementById("selectAll");
        selectAllCheckbox.addEventListener("change", function () {
            var productCheckboxes = document.querySelectorAll(".productCheckbox");
            for (var i = 0; i < productCheckboxes.length; i++) {
                productCheckboxes[i].checked = this.checked;
            }
            updateTotalPrice();
        });


        //勾選更新價格跟勾選框
        var productCheckboxes = document.querySelectorAll(".productCheckbox");
        productCheckboxes.forEach(function (checkbox) {
            checkbox.addEventListener("change", function () {
                updateTotalPrice();
                updateSelectAll();
            });
        });

        document.addEventListener("DOMContentLoaded", function () {
            // 初始化全选框状态
            var selectAllCheckbox = document.getElementById("selectAll");
            selectAllCheckbox.checked = true; // 默认选中全选框

            // 初始化所有商品复选框状态
            var productCheckboxes = document.querySelectorAll(".productCheckbox");
            productCheckboxes.forEach(function (checkbox) {
                checkbox.checked = true; // 默认选中所有商品复选框
            });

            // 更新总价格
            updateTotalPrice();
        });

        // 删除单个商品
        function removeProduct(button) {
            var row = button.parentElement.parentElement; // 获取商品所在的行
            row.remove(); // 从DOM中删除该行
            updateTotalPrice(); // 更新总价格
            updateSelectAll(); // 更新全选复选框
            var productRows = document.querySelectorAll("tbody tr");
            var emptyCartMessage = document.getElementById("emptyCartMessage");
            var deleteAllElement = document.getElementById("deleteAll");
            var otherElements = document.querySelectorAll(".container > *");

            if (productRows.length === 0) {
                // 商品为空，显示空购物车消息并隐藏其他元素
                emptyCartMessage.style.display = "block";
                otherElements.forEach(function (element) {
                    element.style.display = "none";
                    deleteAllElement.style.display = "none";
                });
            }
        }

        // 删除全部商品
        function removeAllProducts() {
            var productCheckboxes = document.querySelectorAll(".productCheckbox");
            productCheckboxes.forEach(function (checkbox) {
                checkbox.checked = false; // 取消选择所有商品的复选框
            });

            var productRows = document.querySelectorAll("tbody tr"); // 获取所有商品行
            productRows.forEach(function (row) {
                row.remove(); // 删除所有商品行
            });

            updateTotalPrice(); // 更新总价格
            updateSelectAll(); // 更新全选复选框

            var productRows = document.querySelectorAll("tbody tr");
            var emptyCartMessage = document.getElementById("emptyCartMessage");
            var deleteAllElement = document.getElementById("deleteAll");
            var otherElements = document.querySelectorAll(".container > *");

            if (productRows.length === 0) {
                // 商品为空，显示空购物车消息并隐藏其他元素
                emptyCartMessage.style.display = "block";
                otherElements.forEach(function (element) {
                    element.style.display = "none";
                    deleteAllElement.style.display = "none";
                });
            }
        }

        document.addEventListener("DOMContentLoaded", function () {
            // 检查商品是否为空
            var productRows = document.querySelectorAll("tbody tr");
            var emptyCartMessage = document.getElementById("emptyCartMessage");
            var otherElements = document.querySelectorAll(".container > *");

            if (productRows.length === 0) {
                // 商品为空，显示空购物车消息并隐藏其他元素
                emptyCartMessage.style.display = "block";
                otherElements.forEach(function (element) {
                    element.style.display = "none";
                });
            }
        });



        //更新總價格
        function updateTotalPrice() {
            var productPrices = document.querySelectorAll(".productPrice");
            var quantities = document.querySelectorAll(".quantity-select");
            var totalAmountElement = document.getElementById("totalAmount");
            var totalAmount = 0;

            for (var i = 0; i < productPrices.length; i++) {
                var priceText = productPrices[i].textContent;
                // console.log(priceText)
                var numericPrice = priceText.replace(/[^\d.]/g, ""); // 移除非数字字符
                var price = parseFloat(numericPrice); // 解析为浮点数
                // console.log(price)
                var quantity = parseInt(quantities[i].value);
                // console.log(quantity)
                var productCheckbox = productPrices[i].parentElement.querySelector(".productCheckbox");//選擇框
                // console.log(productCheckbox);
                if (productCheckbox.checked) {
                    totalAmount += price * quantity;
                }
            }

            totalAmountElement.textContent = totalAmount;
        }




    </script>
</body>

</html>